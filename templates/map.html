{% extends "base.html" %}

{% block content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold mb-2">News Map</h1>
    <p class="text-gray-600">Explore news stories from around the world</p>
</div>

<div id="map" class="w-full h-[600px] rounded-lg shadow-lg"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const map = L.map('map').setView([20, 0], 2);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    const articles = {{ articles|tojson|safe }};
    
    articles.forEach(article => {
        if (article.lat && article.lng) {
            const biasColor = article.bias_score < 0.2 ? '#86efac' : 
                            article.bias_score < 0.5 ? '#fde68a' : '#fca5a5';
            
            const marker = L.circleMarker([article.lat, article.lng], {
                radius: 8,
                fillColor: biasColor,
                color: '#fff',
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map);

            marker.bindPopup(`
                <div class="p-2">
                    <h3 class="font-bold">${article.title}</h3>
                    <p class="text-sm text-gray-600 mt-1">${article.category}</p>
                    <p class="text-sm mt-2">${article.content.substring(0, 100)}...</p>
                    <div class="mt-2">
                        <span class="text-sm px-2 py-1 rounded" style="background-color: ${biasColor}">
                            ${article.bias_score < 0.2 ? 'Low' : article.bias_score < 0.5 ? 'Medium' : 'High'} Bias
                        </span>
                    </div>
                </div>
            `);
        }
    });
});
</script>
{% endblock %}
